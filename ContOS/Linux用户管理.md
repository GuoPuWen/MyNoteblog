# 一、用户相关文件

## 1. /etc/passwd 用户信息文件

vim /etc/passwd

先看一下这个文件的权限：

![](F:\笔记\ContOS\用户管理\2.png)

内容：

![](F:\笔记\ContOS\用户管理\1.png)

- 第1列：用户名，这里有很多伪用户，都是不能登陆的，但是却是很多服务必不可少的
- 第2列：密码位，这里的密码都是保护起来的
- 第3列：用户id
  - 超级用户UID。如果用户UD为0，代表这个账号是管理员账号。要将用户变成管理员用户，只需将这个UID改为0。
  - 1-499系统用户（伪用户）UID。这些UID账号是系统保留给系统用户的UID，也就是说UID是1-499范围内的用户是不能登录系统的，而是用来运行系统或服务的。其中1-99是系统保留的账号，系统自动创建。100-499是预留给用户创建系统账号的。
  - 500-60000普通用户UID。建立的普通用户UID从500开始，最大到60000。这些用户足够使用了，但是如果不够也不用害怕，2.6.x内核以后的Linux系统用户UID已经可以支持2这么多了。

- 第4列：组id 添加新用户时，如果不指定用户所属的初始组，Linux会自动建立和用户名相同的组
- 第5列：用户说明
- 第6列：用户家目录
- 第7列：登陆shell   /sbin/nologin 为不能登陆

## 2./etc/shadow 影子文件

权限：

![](F:\笔记\ContOS\用户管理\3.png)

可见这个文件只能root修改，这个文件保存的内容及其重要。

内容：

![](F:\笔记\ContOS\用户管理\4.png)

- 第1列：用户名
- 第2列：加密密码。可以在密码前面人为的加上”!“可以让这个用户暂时禁止登陆。所有伪用户的密码都是”！“或者”*“，代表这个用户是不能登陆的，注意用户没有密码是不能登陆的
- 第3列：密码最近更改时间，1970年1月1日作为标准时间，上面显示的是时间戳(天数)
- 第4列：两次密码的修改间隔时间
- 第5列：密码的有效期
- 第6列：密码修改到期前的警告天数
- 第7列：密码到期后的宽限天数
- 第8列：密码失效时间

## 3. /etc/group 组信息文件

权限：

![](F:\笔记\ContOS\用户管理\5.png)

内容：

![](F:\笔记\ContOS\用户管理\6.png)

- 第1列：组名
- 第2列：组密码位
- 第3列：GID
- 第4列：此组中支持的其他用户，附加组是此组的用户
  - 初始组：每个用户初始组只能有一个，一般都是和用户名相同的组作为初始组
  - 附加组：每个用户可以有多个附加组
- 第5列：

## 4./etc/gshadow 组密码文件

# 二、用户管理命令

## 1.useradd添加用户

```
[root@localhost ~]# useradd [选项] 用户名 
选项：
	-u 指定UID
	-g 组名指定初始组不要手工指定
	-G 组名指定附加组，把用户加入组，使用附加组
	-c 说明添加说明
	-d 目录手工指定家目录，目录不需要事先建立
 	-s shel1/bin/bash.
```

1. useradd默认值参考文件：/etc/default/useradd  和 /etc/login.defs
   1. /etc/default/useradd 

![](F:\笔记\ContOS\用户管理\7.png)

- GROUP=100　如果useradd没有指定组，并且/etc/login.defs中的USERGROUPS_ENAB为no或者useradd使用了-N选项时，此时该参数生效。创建用户时使用此组ID。
- HOME=/home　　主目录放在什么目录下
- INACTIVE=-1　　帐号是否过期

- EXPIRE=　　帐号终止日期
- SHELL=/bin/bash　　默认使用哪个shell
- SKEL=/etc/skel　　模板目录，骨架目录
- CREATE_MAIL_SPOOL=yes　　是否创建邮箱文件

2.  /etc/login.defs

![](F:\笔记\ContOS\用户管理\8.png)

- MAIL_DIR    /var/spool/mail 创建用户时，要在目录/var/spool/mail中创建一个用户mail文件
- PASS_MAX_DAYS  99999   密码最大有效期
- PASS_MIN_DAYS  0 n两次修改密码的最小间隔时间
- PASS_MIN_LEN  5 密码最小长度，对于root无效
- PASS_WARN_AGE  7 密码过期前多少天开始提示
- UID_MIN          500  用户ID的最小值
- UID_MAX         60000 用户ID的最大值

## 2. 设定密码

```
[root@localhost ~]# passwd [选项] 用户名
选项：
	直接回车，修改当前登陆密码
	-l 暂时锁定用户
	-u 解锁
	--stdin 可以通过使用管道符输出的数据作为用户的密码，用于批量添加用户使用脚本
```

注意：

- 普通用户修改自己密码，只能直接回车，不让指定用户名，即使这个用户名是当前登陆的

![](F:\笔记\ContOS\用户管理\9.png)

- 选项-l暂时锁定用户，其实其他是通过修改/etc/shadow文件来的

  没有锁定前：

  ![](F:\笔记\ContOS\用户管理\10.png)

  使用命令 passwd -l 来锁定用户后：

  ![](F:\笔记\ContOS\用户管理\11.png)

  可见，其实是通过修改配置文件来完成的，也一定上说明了Linux一切皆文件。当然也可以直接通过修改配置文件来锁定用户

## 3.删除用户

```
[root@localhost ~]# userdel -r 用户名
选项：
	-r 在删除用户的同时删除家目录
```

## 4.用户信息修改

```
[root@localhost ~]#usermod  [选项]  用户名 
选项：
	-uUID 修改用户的UID
	-d 家目录：修改用户的家目录。家目录必须写绝对路径
	-c 用户说明：修改用户的说明信息，就是/etc/passwd文件的第五个字段
	-g 组名：修改用户的初始组，就是/etc/passwd文件的第四个字段G组名：修改用户的附加组，其实就是把用户加入其他用户组
	-s shel1：修改用户的登录Shel1。默认是/bin/bash
	-e 日期：修改用户的失效日期，格式为“YYYY-MM-DD”。也就是/etc/shadow文件的第八个字段
	-L 临时锁定用户（Lock）-U：解锁用户（Unlock）
[root@localhost]#usermod -1 新名 旧名
#改名
```

## 5.切换用户身份

```
[rootelocalhost]# su [选项] 用户名 
选项：
	- 选项只使用“”代表连带用户的环境变量一起切换
	-c命令：仅执行一次命令，而不切换用户身份

注意：“-”不能省略，它代表切换用户身份时，用户的环境变量也要切换成新用户的环境变量。
```

# 三、组管理命令

## 1.添加用户组

```
[rootelocalhost ~1#groupadd [选项] 组名
选项：
	-gGID 指定组ID添加用户组
```

## 2. 删除用户组

```
[rootelocalhost ~1#groupdel  组名
```

## 3.把用户添加进组或从组删除

```
[rootelocalhost ~1#gpasswd [选项] 组名
选项：
	-a用户名 把用户加入组
	-d用户名 把用户从组中删除
```

